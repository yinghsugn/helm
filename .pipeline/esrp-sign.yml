parameters:
  - name: "folderPath"
    type: string
    default: $(Build.ArtifactStagingDirectory)/package
  - name: "isEnableSign"
    type: boolean
    default: false

steps:
  - ? ${{ if eq(parameters.isEnableSign, true) }}
    : - task: UseDotNet@2
        displayName: '✔ Use .NET Core sdk'
        inputs:
          packageType: sdk
          version: 2.1.x
          installationPath: $(Agent.ToolsDirectory)/dotnet

      - task: SFP.build-tasks.custom-build-task-1.EsrpCodeSigning@1
        displayName: "✔ ESRP CodeSigning"
        inputs:
          ConnectedServiceName: "ESRP-AED.LinuxPackageSigningForPmc"
          FolderPath: "${{ parameters.folderPath }}"
          Pattern: "*.exe"
          signConfigType: inlineSignParams
          inlineOperation: |
            [
                    {
                        "KeyCode" : "CP-230012",
                        "OperationCode" : "SigntoolSign",
                        "Parameters" : {
                            "OpusName" : "Microsoft",
                            "OpusInfo" : "http://www.microsoft.com",
                            "FileDigest" : "/fd \"SHA256\"",
                            "PageHash" : "/NPH",
                            "TimeStamp" : "/tr \"http://rfc3161.gtm.corp.microsoft.com/TSS/HttpTspServer\" /td sha256"
                        },
                        "ToolName" : "sign",
                        "ToolVersion" : "1.0"
                    },
                    {
                        "KeyCode" : "CP-230012",
                        "OperationCode" : "SigntoolVerify",
                        "Parameters" : {},
                        "ToolName" : "sign",
                        "ToolVersion" : "1.0"
                    }
            ]
